!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).LocalService={})}(this,function(e){"use strict";var t="STREAM_PUMP",n="STREAM_END";var o="SEND_RESPONSE";function s(e,s,r){var a,i=(a=e,new Request(a.url,a.init));return Promise.resolve(r(i)).then(function(e){return function(e){var t={streamBody:!!e.body,init:{}};e.status&&(t.init.status=e.status),e.statusText&&(t.init.statusText=e.statusText);var n={};return e.headers.forEach(function(e,t){n[t]=e}),Object.keys(n).length>0&&(t.init.headers=n),void 0===e.body?e.blob().then(function(e){return 0===e.size&&""===e.type?t.body=null:t.body=e,t}):Promise.resolve(t)}(e).then(function(r){s.postMessage({type:o,payload:r}),r.streamBody&&function(e,o){!function s(){e.read().then(function(e){var r=e.done,a=e.value;if(!r)return o.postMessage({type:t,payload:a}),s();o.postMessage({type:n})})}()}(e.body.getReader(),s)})})}e.startServer=function(e,t){void 0===t&&(t={});var n="https://"+(t.slug?t.slug:Math.floor(1e4*Math.random())+1)+".1.localservice.host",o=document.createElement("iframe");return o.src=n+"/__commrelay__.html",o.name="commRelay",o.id="commRelay",o.style.display="none",o.style.height="1px",o.style.width="1px",document.body.appendChild(o),console.log("Server running at "+n),window.addEventListener("message",function(t){t.origin===n&&s(t.data.payload,t.ports[0],e)}),{url:n}},Object.defineProperty(e,"__esModule",{value:!0})});
