var e="STREAM_PUMP",t="STREAM_END";var n="SEND_RESPONSE";function o(o,a,r){var s,i=(s=o,new Request(s.url,s.init));return Promise.resolve(r(i)).then(function(o){return function(e){var t={streamBody:!!e.body,init:{}};e.status&&(t.init.status=e.status),e.statusText&&(t.init.statusText=e.statusText);var n={};return e.headers.forEach(function(e,t){n[t]=e}),Object.keys(n).length>0&&(t.init.headers=n),void 0===e.body?e.blob().then(function(e){return 0===e.size&&""===e.type?t.body=null:t.body=e,t}):Promise.resolve(t)}(o).then(function(r){a.postMessage({type:n,payload:r}),r.streamBody&&function(n,o){!function a(){n.read().then(function(n){var r=n.done,s=n.value;if(!r)return o.postMessage({type:e,payload:s}),a();o.postMessage({type:t})})}()}(o.body.getReader(),a)})})}var a=function(e,t){void 0===t&&(t={});var n="https://"+(t.slug?t.slug:Math.floor(1e4*Math.random())+1)+".1.localservice.host",a=document.createElement("iframe");return a.src=n+"/__commrelay__.html",a.name="commRelay",a.id="commRelay",a.style.display="none",a.style.height="1px",a.style.width="1px",document.body.appendChild(a),console.log("Server running at "+n),window.addEventListener("message",function(t){t.origin===n&&o(t.data.payload,t.ports[0],e)}),{url:n}};export{a as startServer};
